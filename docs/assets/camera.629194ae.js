import{c,n as p,r as M,d as u,e as d,g as w,o as m,h as b}from"./vendor.7cdf459d.js";function v(l){const o=l.x,i=l.y,e=1;let t;return o*o+i*i<=e*e/2?t=Math.sqrt(e*e-o*o-i*i):t=e*e/2/Math.sqrt(o*o+i*i),new Float32Array([o,-i,t])}class Q{constructor(o,i){this.start=null,this.baseQ=c(),this.currQ=c(),this.getNormalizedMouseCoords=e=>{const t=this.canvas.getBoundingClientRect(),n=(t.left+t.right)/2,a=(t.top+t.bottom)/2,r=t.right-t.left,h=t.bottom-t.top,s=Math.min(r,h);return{x:2*(e.clientX-n)/s,y:2*(e.clientY-a)/s}},this.handleMouseDown=e=>{this.start=this.getNormalizedMouseCoords(e)},this.handleMouseMove=e=>{if(this.start===null)return;const t=v(this.start),n=v(this.getNormalizedMouseCoords(e));p(t,t),p(n,n),M(this.currQ,t,n)},this.handleMouseUp=e=>{this.start!==null&&(u(this.baseQ,this.currQ,this.baseQ),this.currQ=c(),this.start=null)},this.cleanup=()=>{this.canvas.removeEventListener("pointerdown",this.handleMouseDown),window.removeEventListener("pointermove",this.handleMouseMove),window.removeEventListener("pointerup",this.handleMouseUp)},this.update=()=>{this.start===null&&this.options.rotation!==void 0&&u(this.baseQ,this.baseQ,this.options.rotation)},this.getTrackballCameraMatrix=(e,t)=>{const n=u(c(),this.currQ,this.baseQ),a=d();w(a,n);const r=d();if(this.options.ortho){const s=this.options.ortho;m(r,s.left,s.right,s.bottom,s.top,s.near,s.far)}else{let s=1;m(r,-s,s,-s,s,-s,s)}const h=d();return b(h,r,a),h},this.options=i,this.canvas=o,this.canvas.addEventListener("pointerdown",this.handleMouseDown),window.addEventListener("pointermove",this.handleMouseMove),window.addEventListener("pointerup",this.handleMouseUp)}}export{Q as T};
