import{b as r,n as u,r as L,m as l,s as p,d as v,e as E,o as M,g as b}from"./quat-BHbpDEQk.js";function d(m){const i=m.x,s=m.y,e=1;let t;return i*i+s*s<=e*e/2?t=Math.sqrt(e*e-i*i-s*s):t=e*e/2/Math.sqrt(i*i+s*s),new Float32Array([i,-s,t])}class f{constructor(i,s){this.mouseLoc=null,this.baseQ=r(),this.currQ=r(),this.momentumQ=r(),this.currentMomentumLevel=0,this.getNormalizedMouseCoords=e=>{const t=this.canvas.getBoundingClientRect(),o=(t.left+t.right)/2,h=(t.top+t.bottom)/2,c=t.right-t.left,n=t.bottom-t.top,a=Math.min(c,n);return{x:2*(e.clientX-o)/a,y:2*(e.clientY-h)/a}},this.handleMouseDown=e=>{const t=this.getNormalizedMouseCoords(e);this.mouseLoc={start:t,current:t,previous:t}},this.handleMouseMove=e=>{if(this.mouseLoc===null)return;this.mouseLoc.previous=this.mouseLoc.current,this.mouseLoc.current=this.getNormalizedMouseCoords(e);const t=d(this.mouseLoc.start),o=d(this.mouseLoc.current);u(t,t),u(o,o),L(this.currQ,t,o)},this.handleMouseUp=e=>{if(this.mouseLoc===null)return;const t=d(this.mouseLoc.previous),o=d(this.mouseLoc.current);u(t,t),u(o,o),L(this.momentumQ,t,o),l(this.baseQ,this.currQ,this.baseQ),this.currQ=r(),this.mouseLoc=null,this.currentMomentumLevel=1},this.discardTouchEvent=e=>e.preventDefault(),this.cleanup=()=>{this.canvas.removeEventListener("pointerdown",this.handleMouseDown),window.removeEventListener("pointermove",this.handleMouseMove),window.removeEventListener("pointerup",this.handleMouseUp),this.canvas.removeEventListener("touchstart",this.discardTouchEvent),this.canvas.removeEventListener("touchmove",this.discardTouchEvent),this.canvas.removeEventListener("touchend",this.discardTouchEvent),this.canvas.removeEventListener("touchcancel",this.discardTouchEvent)},this.update=()=>{if(this.mouseLoc===null){const e=p(r(),this.rotationQ,this.momentumQ,this.currentMomentumLevel);this.currentMomentumLevel*=this.dampingFactor,l(this.baseQ,e,this.baseQ)}},this.getTrackballCameraMatrix=(e,t)=>{const o=l(r(),this.currQ,this.baseQ),h=v();E(h,o);const c=v(),n=this.ortho;M(c,n.left,n.right,n.bottom,n.top,n.near,n.far);const a=v();return b(a,c,h),a},s.ortho?this.ortho=s.ortho:this.ortho={left:-1,right:1,bottom:-1,top:1,near:-1,far:1},s.rotation?this.rotationQ=s.rotation:this.rotationQ=r(),s.dampingFactor!==void 0?this.dampingFactor=s.dampingFactor:this.dampingFactor=.9,this.canvas=i,this.canvas.addEventListener("pointerdown",this.handleMouseDown),window.addEventListener("pointermove",this.handleMouseMove),window.addEventListener("pointerup",this.handleMouseUp),this.canvas.addEventListener("touchstart",this.discardTouchEvent),this.canvas.addEventListener("touchmove",this.discardTouchEvent),this.canvas.addEventListener("touchend",this.discardTouchEvent),this.canvas.addEventListener("touchcancel",this.discardTouchEvent)}}export{f as T};
