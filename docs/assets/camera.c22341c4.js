import{c as r,n as d,r as L,d as l,s as p,e as v,g as E,o as M,h as f}from"./vendor.d935a807.js";function b(a,o){if(!a)throw new Error(o)}function m(a){const o=a.x,s=a.y,e=1;let t;return o*o+s*s<=e*e/2?t=Math.sqrt(e*e-o*o-s*s):t=e*e/2/Math.sqrt(o*o+s*s),new Float32Array([o,-s,t])}class g{constructor(o,s){this.mouseLoc=null,this.baseQ=r(),this.currQ=r(),this.momentumQ=r(),this.currentMomentumLevel=0,this.getNormalizedMouseCoords=e=>{const t=this.canvas.getBoundingClientRect(),i=(t.left+t.right)/2,c=(t.top+t.bottom)/2,u=t.right-t.left,n=t.bottom-t.top,h=Math.min(u,n);return{x:2*(e.clientX-i)/h,y:2*(e.clientY-c)/h}},this.handleMouseDown=e=>{const t=this.getNormalizedMouseCoords(e);this.mouseLoc={start:t,current:t,previous:t}},this.handleMouseMove=e=>{if(this.mouseLoc===null)return;this.mouseLoc.previous=this.mouseLoc.current,this.mouseLoc.current=this.getNormalizedMouseCoords(e);const t=m(this.mouseLoc.start),i=m(this.mouseLoc.current);d(t,t),d(i,i),L(this.currQ,t,i)},this.handleMouseUp=e=>{if(this.mouseLoc===null)return;const t=m(this.mouseLoc.previous),i=m(this.mouseLoc.current);d(t,t),d(i,i),L(this.momentumQ,t,i),l(this.baseQ,this.currQ,this.baseQ),this.currQ=r(),this.mouseLoc=null,this.currentMomentumLevel=1},this.discardTouchEvent=e=>e.preventDefault(),this.cleanup=()=>{this.canvas.removeEventListener("pointerdown",this.handleMouseDown),window.removeEventListener("pointermove",this.handleMouseMove),window.removeEventListener("pointerup",this.handleMouseUp),this.canvas.removeEventListener("touchstart",this.discardTouchEvent),this.canvas.removeEventListener("touchmove",this.discardTouchEvent),this.canvas.removeEventListener("touchend",this.discardTouchEvent),this.canvas.removeEventListener("touchcancel",this.discardTouchEvent)},this.update=()=>{if(this.mouseLoc===null){const e=p(r(),this.rotationQ,this.momentumQ,this.currentMomentumLevel);this.currentMomentumLevel*=this.dampingFactor,l(this.baseQ,e,this.baseQ)}},this.getTrackballCameraMatrix=(e,t)=>{const i=l(r(),this.currQ,this.baseQ),c=v();E(c,i);const u=v(),n=this.ortho;M(u,n.left,n.right,n.bottom,n.top,n.near,n.far);const h=v();return f(h,u,c),h},s.ortho?this.ortho=s.ortho:this.ortho={left:-1,right:1,bottom:-1,top:1,near:-1,far:1},s.rotation?this.rotationQ=s.rotation:this.rotationQ=r(),s.dampingFactor!==void 0?this.dampingFactor=s.dampingFactor:this.dampingFactor=.9,this.canvas=o,this.canvas.addEventListener("pointerdown",this.handleMouseDown),window.addEventListener("pointermove",this.handleMouseMove),window.addEventListener("pointerup",this.handleMouseUp),this.canvas.addEventListener("touchstart",this.discardTouchEvent),this.canvas.addEventListener("touchmove",this.discardTouchEvent),this.canvas.addEventListener("touchend",this.discardTouchEvent),this.canvas.addEventListener("touchcancel",this.discardTouchEvent)}}export{g as T,b as a};
