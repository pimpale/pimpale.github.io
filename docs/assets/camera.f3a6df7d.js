import{c as n,n as u,r as p,d,s as L,e as v,g as M,o as g,h as f}from"./vendor.8c8c5e31.js";function m(l){const r=l.x,o=l.y,e=1;let t;return r*r+o*o<=e*e/2?t=Math.sqrt(e*e-r*r-o*o):t=e*e/2/Math.sqrt(r*r+o*o),new Float32Array([r,-o,t])}class w{constructor(r,o){this.mouseLoc=null,this.baseQ=n(),this.currQ=n(),this.momentumQ=n(),this.currentMomentumLevel=0,this.getNormalizedMouseCoords=e=>{const t=this.canvas.getBoundingClientRect(),s=(t.left+t.right)/2,h=(t.top+t.bottom)/2,c=t.right-t.left,i=t.bottom-t.top,a=Math.min(c,i);return{x:2*(e.clientX-s)/a,y:2*(e.clientY-h)/a}},this.handleMouseDown=e=>{e.preventDefault(),e.stopPropagation();const t=this.getNormalizedMouseCoords(e);this.mouseLoc={start:t,current:t,previous:t}},this.handleMouseMove=e=>{if(this.mouseLoc===null)return;e.preventDefault(),e.stopPropagation(),this.mouseLoc.previous=this.mouseLoc.current,this.mouseLoc.current=this.getNormalizedMouseCoords(e);const t=m(this.mouseLoc.start),s=m(this.mouseLoc.current);u(t,t),u(s,s),p(this.currQ,t,s)},this.handleMouseUp=e=>{if(this.mouseLoc===null)return;e.preventDefault(),e.stopPropagation();const t=m(this.mouseLoc.previous),s=m(this.mouseLoc.current);u(t,t),u(s,s),p(this.momentumQ,t,s),d(this.baseQ,this.currQ,this.baseQ),this.currQ=n(),this.mouseLoc=null,this.currentMomentumLevel=1},this.cleanup=()=>{this.canvas.removeEventListener("mousedown",this.handleMouseDown),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)},this.update=()=>{if(this.mouseLoc===null){const e=L(n(),this.rotationQ,this.momentumQ,this.currentMomentumLevel);this.currentMomentumLevel*=this.dampingFactor,d(this.baseQ,e,this.baseQ)}},this.getTrackballCameraMatrix=(e,t)=>{const s=d(n(),this.currQ,this.baseQ),h=v();M(h,s);const c=v(),i=this.ortho;g(c,i.left,i.right,i.bottom,i.top,i.near,i.far);const a=v();return f(a,c,h),a},o.ortho?this.ortho=o.ortho:this.ortho={left:-1,right:1,bottom:-1,top:1,near:-1,far:1},o.rotation?this.rotationQ=o.rotation:this.rotationQ=n(),o.dampingFactor!==void 0?this.dampingFactor=o.dampingFactor:this.dampingFactor=.9,this.canvas=r,this.canvas.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}}export{w as T};
